<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cadastro — Pink Store</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css?v=dark-pink" />
  <style>
    /* Pequenos estilos locais para o fluxo de checkout */
    .step { display: none; }
    .step.active { display: block; }
    .payment-options{ display:flex; gap:.6rem; margin:.5rem 0; }
    .confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:10000; }
    .confetti-piece{ position:absolute; width:12px; height:18px; opacity:0.9; border-radius:2px; transform:translateY(-100vh); }
    .center-note{ color:#b8bac0; margin-bottom:1rem; }

    /* Novos estilos para alinhamento e responsividade */
    form { box-sizing: border-box; }
    form label { display:block; font-size:0.95rem; color: #e6e6e6; }
    input { width:100%; padding:.5rem .6rem; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit; box-sizing:border-box; }

    /* Grid para o cadastro e para o formulário de pagamento */
    .form-grid { display:grid; grid-template-columns: 1fr 1fr; gap:.75rem; }
    .form-grid .full { grid-column: 1 / -1; }

    /* Row com label fixa e campo flexível para alinhamento */
    .form-row { display:grid; grid-template-columns: 150px 1fr; gap:.6rem; align-items:center; }
    .form-row label { margin:0; font-weight:600; color:#dcdcdc; }
    .form-row input { margin:0; }

    /* Campos do cartão alinhados */
    .card-grid { display:grid; grid-template-columns: 1fr; gap:.6rem; align-items:center; }
    .card-grid .two { display:grid; grid-template-columns: 1fr 1fr; gap:.6rem; }

    /* Ajustes para botões */
    .btn-row { display:flex; gap:.5rem; }

    /* Responsivo: telas estreitas usam coluna única */
    @media (max-width:720px) {
      .form-grid { grid-template-columns: 1fr; }
      .form-row { grid-template-columns: 1fr; }
      .card-grid .two { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <img src="assets/logo.svg" alt="Logo Pink Store" class="logo" />
    </div>
  </header>

  <main style="max-width:720px;margin:48px auto;padding:0 18px;">
    <section class="card-produto" style="padding:2rem;">
      <h1 style="margin-bottom:1rem;">Finalize seu pedido</h1>

      <p id="resumo-pedido" class="center-note"></p>

      <!-- Etapa 1: Cadastro -->
      <div id="step-cadastro" class="step active">
        <form id="form-cadastro" class="form-grid" autocomplete="on">

          <div class="form-row full">
            <label for="nome">Nome completo</label>
            <input id="nome" type="text" required />
          </div>

          <div class="form-row">
            <label for="email">Email</label>
            <input id="email" type="email" required />
          </div>

          <div class="form-row">
            <label for="telefone">Telefone</label>
            <input id="telefone" type="tel" />
          </div>

          <div class="form-row full">
            <label for="endereco">Endereço</label>
            <input id="endereco" type="text" required />
          </div>

          <div class="full btn-row">
            <button id="btn-proximo" type="submit" class="btn-brilho">Prosseguir para pagamento</button>
          </div>
        </form>
      </div>

      <!-- Etapa 2: Pagamento -->
      <div id="step-pagamento" class="step">
        <h2 style="margin-top:0;margin-bottom:.5rem;">Pagamento</h2>
        <p class="center-note">Escolha a forma de pagamento e insira as informações.</p>

        <div style="margin-bottom:.5rem;">
          <strong>Total:</strong> <span id="total-pagamento"></span>
        </div>

        <div class="payment-options" role="radiogroup" aria-label="Opções de pagamento">
          <label style="display:flex;align-items:center;gap:.4rem;">
            <input type="radio" name="pay-method" value="card" checked /> Cartão
          </label>
          <label style="display:flex;align-items:center;gap:.4rem;">
            <input type="radio" name="pay-method" value="pix" /> PIX
          </label>
        </div>

        <form id="form-pagamento" class="form-grid" style="gap:.6rem;">
          <div id="card-fields" class="card-grid full">
            <div class="form-row">
              <label for="card-name">Nome no cartão</label>
              <input id="card-name" type="text" required />
            </div>

            <div class="form-row">
              <label for="card-number">Número do cartão</label>
              <input id="card-number" type="text" inputmode="numeric" maxlength="19" placeholder="1234 5678 9012 3456" required />
            </div>

            <div class="two">
              <div class="form-row">
                <label for="card-exp">Validade</label>
                <input id="card-exp" type="text" placeholder="MM/AA" required />
              </div>
              <div class="form-row">
                <label for="card-cvc">CVC</label>
                <input id="card-cvc" type="text" inputmode="numeric" maxlength="4" required />
              </div>
            </div>
          </div>

          <div id="pix-fields" style="display:none;" class="full">
            <p style="margin:.25rem 0;color:#b8bac0;">Chave PIX (copiar/colar para pagar): <strong>contato@pinkstore.com</strong></p>
            <div class="form-row">
              <label for="pix-name">Nome do pagador (PIX)</label>
              <input id="pix-name" type="text" />
            </div>
            <div class="form-row">
              <label for="pix-proof">Comprovante (opcional)</label>
              <input id="pix-proof" type="text" placeholder="URL ou código" />
            </div>
          </div>

          <div class="full btn-row" style="margin-top:.5rem;">
            <button id="btn-pagar" type="button" class="btn-brilho">Pagar</button>
            <button id="btn-voltar" type="button" class="icon">Voltar</button>
          </div>
        </form>

        <p id="msg-status" style="margin-top:1rem;color:#b8bac0;"></p>
      </div>

      <!-- Etapa 3: Sucesso -->
      <div id="step-sucesso" class="step" style="text-align:center;">
        <h2>Pagamento confirmado!</h2>
        <p class="center-note">Obrigada pela compra. Em instantes você receberá a confirmação por email.</p>
        <div style="margin-top:1rem;">
          <a href="index.html" class="btn-brilho">Voltar para a loja</a>
        </div>
      </div>

    </section>
  </main>

  <div id="confetti-container" class="confetti" aria-hidden="true"></div>

  <footer>Pink Store &copy; 2025</footer>

  <script>
    // Carregar resumo do pedido salvo
    const resumoEl = document.getElementById('resumo-pedido');
    const pedido = JSON.parse(localStorage.getItem('ps_pedido') || 'null');
    if (!pedido) {
      resumoEl.textContent = 'Nenhum pedido encontrado. Volte ao site e adicione itens ao carrinho.';
    } else {
      resumoEl.innerHTML = `Você está prestes a comprar <strong>${pedido.itens.length}</strong> itens. Total: <strong>${new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(pedido.total)}</strong>`;
      document.getElementById('total-pagamento').textContent = new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(pedido.total);
    }

    const stepCadastro = document.getElementById('step-cadastro');
    const stepPagamento = document.getElementById('step-pagamento');
    const stepSucesso = document.getElementById('step-sucesso');

    const formCadastro = document.getElementById('form-cadastro');
    const formPagamento = document.getElementById('form-pagamento');
    const msgStatus = document.getElementById('msg-status');

    // Desativar validação nativa para controlar feedback manualmente
    if (formPagamento) formPagamento.noValidate = true;

    // Avançar para pagamento
    formCadastro.addEventListener('submit', (e) => {
      e.preventDefault();
      // salvar cliente
      const dados = {
        nome: document.getElementById('nome').value,
        email: document.getElementById('email').value,
        telefone: document.getElementById('telefone').value,
        endereco: document.getElementById('endereco').value
      };
      try {
        localStorage.setItem('ps_cliente', JSON.stringify(dados));
      } catch (err) { console.error(err); }
      // mostrar pagamento
      stepCadastro.classList.remove('active');
      stepPagamento.classList.add('active');
      window.scrollTo(0,0);
    });

    // Alternar campos conforme método
    document.querySelectorAll('input[name="pay-method"]').forEach(r => r.addEventListener('change', (e) => {
      const v = e.target.value;
      document.getElementById('card-fields').style.display = v === 'card' ? 'block' : 'none';
      document.getElementById('pix-fields').style.display = v === 'pix' ? 'block' : 'none';
    }));

    document.getElementById('btn-voltar').addEventListener('click', () => {
      stepPagamento.classList.remove('active');
      stepCadastro.classList.add('active');
    });

    // Lógica de pagamento isolada para evitar dupla execução e garantir que o clique funcione
    function processPayment(ev) {
      if (ev && ev.preventDefault) ev.preventDefault();
      msgStatus.textContent = '';
      msgStatus.style.color = '#b8bac0';

      const metodo = document.querySelector('input[name="pay-method"]:checked').value;
      if (metodo === 'card') {
        const nomeCard = document.getElementById('card-name').value.trim();
        const num = document.getElementById('card-number').value.trim();
        const exp = document.getElementById('card-exp').value.trim();
        const cvc = document.getElementById('card-cvc').value.trim();
        if (!nomeCard || !num || !exp || !cvc) {
          msgStatus.textContent = 'Preencha todos os dados do cartão.';
          return;
        }
      }

      msgStatus.textContent = 'Processando pagamento...';

      setTimeout(() => {
        msgStatus.textContent = 'Pagamento realizado com sucesso!';
        localStorage.removeItem('ps_carrinho');
        localStorage.removeItem('ps_pedido');
        stepPagamento.classList.remove('active');
        stepSucesso.classList.add('active');
        dispararConfetti();
      }, 900);
    }

    // Associar ao submit do form (por segurança) e ao clique do botão
    formPagamento.addEventListener('submit', processPayment);
    const btnPagar = document.getElementById('btn-pagar');
    if (btnPagar) btnPagar.addEventListener('click', processPayment);

    // Confetti generator (rosas)
    function dispararConfetti(duration = 3000) {
      const container = document.getElementById('confetti-container');
      const colors = ['#ff8fb3','#ff4f96','#e91e63','#ffb6d5'];
      const end = Date.now() + duration;
      const pieces = [];

      function criarPeca() {
        const el = document.createElement('div');
        el.className = 'confetti-piece';
        el.style.background = colors[Math.floor(Math.random()*colors.length)];
        el.style.left = Math.random()*100 + '%';
        el.style.top = '-5%';
        el.style.transform = `translateY(-100vh) rotate(${Math.random()*360}deg)`;
        el.style.opacity = String(0.9 + Math.random()*0.1);
        el.style.width = (8 + Math.random()*12) + 'px';
        el.style.height = (10 + Math.random()*18) + 'px';
        container.appendChild(el);
        pieces.push(el);

        // animar com transições CSS via requestAnimationFrame
        const durationFall = 2000 + Math.random()*2000;
        el.animate([
          { transform: el.style.transform, opacity: el.style.opacity },
          { transform: `translateY(${window.innerHeight + 100}px) rotate(${Math.random()*720}deg)`, opacity: 0.9 }
        ], { duration: durationFall, easing: 'cubic-bezier(.2,.8,.2,1)' });

        // remover após animação
        setTimeout(() => { try { container.removeChild(el); } catch(e){} }, durationFall + 200);
      }

      const iv = setInterval(() => {
        if (Date.now() > end) { clearInterval(iv); return; }
        // criar algumas peças por intervalo
        for (let i=0;i<6;i++) criarPeca();
      }, 150);

      // cleanup final
      setTimeout(() => { try { pieces.forEach(p=>p.remove()); } catch(e){} }, duration + 3000);
    }
  </script>
</body>
</html>
